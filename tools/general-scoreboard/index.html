<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title data-en="General Scoreboard" data-zh-HK="é€šç”¨è¨ˆåˆ†æ¿">
      General Scoreboard
    </title>
    <link rel="stylesheet" href="../../assets/style.css" />
    <link rel="stylesheet" href="styles.css" />
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#1976d2" />
    <link rel="apple-touch-icon" href="icon-512.png" />
  </head>
  <body>
    <header id="siteHeader" class="site-header"></header>

    <main class="scoreboard-app">
      <!-- Dashboard: session list (shown when has sessions, no current game open) -->
      <section id="dashboardSection" class="dashboard-section" hidden>
        <div class="scoreboard-heading">
          <h1 data-en="General Scoreboard" data-zh-HK="é€šç”¨è¨ˆåˆ†æ¿">General Scoreboard</h1>
          <p class="subtitle" data-en="Choose a game or start a new one" data-zh-HK="é¸æ“‡ä¸€å±€æˆ–é–‹æ–°å±€">Choose a game or start a new one</p>
        </div>
        <div class="dashboard-actions">
          <button type="button" id="newGameBtn" class="btn btn-primary" data-en="+ New game" data-zh-HK="+ æ–°å±€">+ New game</button>
        </div>
        <div id="sessionList" class="session-list"></div>
      </section>

      <!-- Initial setup (new game or reset current) -->
      <section id="initSection" class="init-section">
        <div class="scoreboard-heading">
          <h1 data-en="General Scoreboard" data-zh-HK="é€šç”¨è¨ˆåˆ†æ¿">
            General Scoreboard
          </h1>
          <p class="subtitle" data-en="Track scores for card games, mahjong, and more" data-zh-HK="æ’²å…‹ã€éº»å°‡ç­‰é€šç”¨è¨ˆåˆ†">
            Track scores for card games, mahjong, and more
          </p>
        </div>
        <div class="init-form card">
          <h2 data-en="Setup" data-zh-HK="åˆå§‹è¨­å®š">Setup</h2>
          <div class="form-group">
            <label for="sessionName" data-en="Game / Session name:" data-zh-HK="å±€å / å ´æ¬¡åç¨±ï¼š">Game / Session name:</label>
            <input type="text" id="sessionName" placeholder="" data-placeholder-en="e.g. Feb 18 Big Two" data-placeholder-zh-Hant="ä¾‹ï¼š2æœˆ18æ—¥ é‹¤å¤§D" />
          </div>
          <div class="form-group">
            <label for="playerCount" data-en="Number of players:" data-zh-HK="ç©å®¶äººæ•¸ï¼š">Number of players:</label>
            <input type="number" id="playerCount" min="2" max="20" value="4" />
          </div>
          <div class="form-group">
            <label data-en="Starting score (default 0):" data-zh-HK="èµ·æ­¥åº•åˆ†ï¼ˆé è¨­ 0ï¼‰ï¼š">Starting score (default 0):</label>
            <input type="text" id="startingScore" class="score-input" value="0" readonly inputmode="none" placeholder="0" data-placeholder-en="0" data-placeholder-zh-Hant="0" />
          </div>
          <div id="playerNamesContainer" class="player-names-container"></div>
          <button type="button" id="startScoreboardBtn" class="btn btn-primary" data-en="Start scoring" data-zh-HK="é–‹å§‹è¨ˆåˆ†">
            Start scoring
          </button>
        </div>
      </section>

      <!-- Main scoreboard (current session) -->
      <section id="mainSection" class="main-section" hidden>
        <div class="main-section-header">
          <div class="scoreboard-heading scoreboard-heading-inline">
            <button type="button" id="backToDashboardBtn" class="btn btn-icon-text" data-en="â† Dashboard" data-zh-HK="â† è¿”å›ä¸»é¸å–®">â† Dashboard</button>
            <h1 id="currentSessionTitle" class="session-title">â€”</h1>
          </div>
        </div>

        <!-- Player cards -->
        <section class="players-section card">
          <div class="players-header">
            <h2 data-en="Players" data-zh-HK="ç©å®¶">Players</h2>
            <button type="button" id="addPlayerBtn" class="btn btn-secondary" data-en="+ Add player" data-zh-HK="+ æ–°å¢ç©å®¶">+ Add player</button>
          </div>
          <div id="playerCards" class="player-cards"></div>
        </section>

        <!-- Mode Tabs -->
        <div class="tabs-container card">
          <div class="tabs-header" role="tablist">
            <button type="button" class="tab-btn active" role="tab" data-mode="a" aria-selected="true" data-en="One wins, others pay" data-zh-HK="ä¸€è´å¤šè¼¸">One wins, others pay</button>
            <button type="button" class="tab-btn" role="tab" data-mode="b" aria-selected="false" data-en="One pays all" data-zh-HK="ä¸€è¼¸å¤šè´">One pays all</button>
            <button type="button" class="tab-btn" role="tab" data-mode="c" aria-selected="false" data-en="Transfer Aâ†’B" data-zh-HK="ä¸€å°ä¸€éæ•¸">Transfer Aâ†’B</button>
            <button type="button" class="tab-btn" role="tab" data-mode="d" aria-selected="false" data-en="Add/Subtract" data-zh-HK="å–®ç¨åŠ æ¸›">Add/Subtract</button>
          </div>

          <!-- Mode A: One winner, others input loss -->
          <div id="panelA" class="tab-panel active" role="tabpanel">
            <h3 data-en="Select winner, enter amount each loser pays" data-zh-HK="é¸è´å®¶ï¼Œè¼¸å…¥å„è¼¸å®¶ä»˜çµ¦è´å®¶çš„åˆ†æ•¸">Select winner, enter amount each loser pays</h3>
            <div class="mode-a-form">
              <div class="form-group">
                <label data-en="Winner:" data-zh-HK="è´å®¶ï¼š">Winner:</label>
                <div id="modeAWinnerChips" class="player-chips" role="group"></div>
              </div>
              <div id="modeALosers" class="mode-losers"></div>
              <div class="form-group remark-group">
                <label for="modeARemark" data-en="Remark (optional):" data-zh-HK="å‚™è¨»ï¼ˆé¸å¡«ï¼‰ï¼š">Remark (optional):</label>
                <input type="text" id="modeARemark" class="remark-input" placeholder="" data-placeholder-en="e.g. Round 1, penalty" data-placeholder-zh-Hant="ä¾‹ï¼šç¬¬ä¸€å±€ã€ç½°åˆ†" />
              </div>
              <button type="button" id="modeACalcBtn" class="btn btn-primary" data-en="Calculate" data-zh-HK="è¨ˆç®—">Calculate</button>
            </div>
          </div>

          <!-- Mode B: One big loser, others input win -->
          <div id="panelB" class="tab-panel" role="tabpanel" hidden>
            <h3 data-en="Select big loser, enter amount each winner gets" data-zh-HK="é¸å¤§è¼¸å®¶ï¼Œè¼¸å…¥å„è´å®¶è´å¾—çš„åˆ†æ•¸">Select big loser, enter amount each winner gets</h3>
            <div class="mode-b-form">
              <div class="form-group">
                <label data-en="Big loser:" data-zh-HK="å¤§è¼¸å®¶ï¼š">Big loser:</label>
                <div id="modeBLoserChips" class="player-chips" role="group"></div>
              </div>
              <div id="modeBWinners" class="mode-winners"></div>
              <div class="form-group remark-group">
                <label for="modeBRemark" data-en="Remark (optional):" data-zh-HK="å‚™è¨»ï¼ˆé¸å¡«ï¼‰ï¼š">Remark (optional):</label>
                <input type="text" id="modeBRemark" class="remark-input" placeholder="" data-placeholder-en="e.g. Round 1" data-placeholder-zh-Hant="ä¾‹ï¼šç¬¬ä¸€å±€" />
              </div>
              <button type="button" id="modeBCalcBtn" class="btn btn-primary" data-en="Calculate" data-zh-HK="è¨ˆç®—">Calculate</button>
            </div>
          </div>

          <!-- Mode C: Transfer from A to B -->
          <div id="panelC" class="tab-panel" role="tabpanel" hidden>
            <h3 data-en="Transfer points from one player to another" data-zh-HK="ç©å®¶ A éæ•¸çµ¦ç©å®¶ B">Transfer points from one player to another</h3>
            <div class="mode-c-form">
              <div class="form-group">
                <label data-en="From:" data-zh-HK="å¾ï¼š">From:</label>
                <div id="modeCFromChips" class="player-chips" role="group"></div>
              </div>
              <div class="form-group">
                <label data-en="To:" data-zh-HK="çµ¦ï¼š">To:</label>
                <div id="modeCToChips" class="player-chips" role="group"></div>
              </div>
              <div class="form-group">
                <label data-en="Amount:" data-zh-HK="åˆ†æ•¸ï¼š">Amount:</label>
                <input type="text" id="modeCAmount" class="score-input" readonly inputmode="none" placeholder="0" data-placeholder-en="0" data-placeholder-zh-Hant="0" />
              </div>
              <div class="form-group remark-group">
                <label for="modeCRemark" data-en="Remark (optional):" data-zh-HK="å‚™è¨»ï¼ˆé¸å¡«ï¼‰ï¼š">Remark (optional):</label>
                <input type="text" id="modeCRemark" class="remark-input" placeholder="" data-placeholder-en="e.g. Debt" data-placeholder-zh-Hant="ä¾‹ï¼šé‚„æ¬¾" />
              </div>
              <button type="button" id="modeCTransferBtn" class="btn btn-primary" data-en="Transfer" data-zh-HK="éæ•¸">Transfer</button>
            </div>
          </div>

          <!-- Mode D: Single player add/subtract -->
          <div id="panelD" class="tab-panel" role="tabpanel" hidden>
            <h3 data-en="Add or subtract points for one player" data-zh-HK="å–®ç¨ç‚ºä¸€ä½ç©å®¶åŠ æ¸›åˆ†">Add or subtract points for one player</h3>
            <div class="mode-d-form">
              <div class="form-group">
                <label data-en="Player:" data-zh-HK="ç©å®¶ï¼š">Player:</label>
                <div id="modeDPlayerChips" class="player-chips" role="group"></div>
              </div>
              <div class="form-group">
                <label data-en="Points (positive = add, negative = subtract):" data-zh-HK="åˆ†æ•¸ï¼ˆæ­£æ•¸åŠ åˆ†ï¼Œè² æ•¸æ‰£åˆ†ï¼‰ï¼š">Points (positive = add, negative = subtract):</label>
                <input type="text" id="modeDPoints" class="score-input" readonly inputmode="none" placeholder="0" data-placeholder-en="0" data-placeholder-zh-Hant="0" />
              </div>
              <div class="form-group remark-group">
                <label for="modeDRemark" data-en="Remark (optional):" data-zh-HK="å‚™è¨»ï¼ˆé¸å¡«ï¼‰ï¼š">Remark (optional):</label>
                <input type="text" id="modeDRemark" class="remark-input" placeholder="" data-placeholder-en="e.g. Penalty, bonus" data-placeholder-zh-Hant="ä¾‹ï¼šç½°åˆ†ã€çå‹µ" />
              </div>
              <button type="button" id="modeDApplyBtn" class="btn btn-primary" data-en="Apply" data-zh-HK="å¥—ç”¨">Apply</button>
            </div>
          </div>
        </div>

        <!-- History Log -->
        <section class="history-section card">
          <div class="history-header">
            <h2 data-en="History Log" data-zh-HK="åˆ†æ•¸è®Šå‹•ç´€éŒ„">History Log</h2>
            <button type="button" id="clearHistoryBtn" class="btn btn-secondary" data-en="Clear history" data-zh-HK="æ¸…ç©ºç´€éŒ„">Clear history</button>
          </div>
          <div id="historyList" class="history-list" role="log"></div>
        </section>

        <div class="main-actions">
          <button type="button" id="settlementBtn" class="btn btn-primary" data-en="ğŸ† End game / Settlement" data-zh-HK="ğŸ† çµç®—æœ¬å±€">ğŸ† End game / Settlement</button>
          <button type="button" id="resetSessionBtn" class="btn btn-secondary" data-en="Reset this game" data-zh-HK="é‡ç½®æœ¬å±€">Reset this game</button>
          <button type="button" id="deleteSessionBtn" class="btn btn-secondary btn-danger" data-en="Delete game" data-zh-HK="åˆªé™¤æ­¤å±€">Delete game</button>
        </div>
      </section>

      <!-- View C: Settlement Summary (hidden by default) -->
      <section id="settlementSection" class="settlement-section" hidden>
        <div class="scoreboard-heading">
          <h1 data-en="Settlement" data-zh-HK="çµç®—æœ¬å±€">Settlement</h1>
          <p id="settlementSessionName" class="subtitle">â€”</p>
        </div>
        <div class="settlement-card card">
          <h2 data-en="Leaderboard" data-zh-HK="æ’è¡Œæ¦œ">Leaderboard</h2>
          <div id="settlementLeaderboard" class="settlement-leaderboard"></div>
          <div class="settlement-stats">
            <span data-en="Total records:" data-zh-HK="æœ¬å±€ç¸½ç´€éŒ„æ¬¡æ•¸ï¼š">Total records:</span>
            <strong id="settlementTotalRecords">0</strong>
          </div>
        </div>
        <div class="settlement-card card">
          <h2 data-en="ğŸ“ Settlement Plan" data-zh-HK="ğŸ“ æ‰¾æ•¸å»ºè­°">ğŸ“ Settlement Plan</h2>
          <div id="settlementPlan" class="settlement-plan"></div>
        </div>
        <div class="settlement-actions">
          <button type="button" id="copyResultsBtn" class="btn btn-primary" data-en="ğŸ“‹ Copy results" data-zh-HK="ğŸ“‹ è¤‡è£½è³½æœ">ğŸ“‹ Copy results</button>
          <button type="button" id="confirmSettlementBtn" class="btn btn-primary" data-en="Confirm settlement & back to dashboard" data-zh-HK="ç¢ºèªçµç®— / è¿”å›å¤§å»³">Confirm settlement & back to dashboard</button>
          <button type="button" id="backFromSettlementBtn" class="btn btn-secondary" data-en="â† Back to scoreboard" data-zh-HK="â† è¿”å›è¨ˆåˆ†æ¿">â† Back to scoreboard</button>
          <button type="button" id="deleteFromSettlementBtn" class="btn btn-secondary btn-danger" data-en="Delete game" data-zh-HK="åˆªé™¤æ­¤å±€">Delete game</button>
        </div>
      </section>
    </main>

    <!-- Zero-sum error modal -->
    <div id="zeroSumErrorModal" class="modal-overlay" aria-hidden="true" hidden>
      <div class="modal-content modal-error">
        <p class="modal-message" id="zeroSumErrorText">âš ï¸ åˆ†æ•¸ä¸å¹³è¡¡ï¼ç¸½åˆ†æ•¸èˆ‡åˆå§‹ç¸½åˆ†æ•¸ä¸ç¬¦ï¼Œè«‹æª¢æŸ¥æ­·å²ç´€éŒ„æ˜¯å¦æœ‰èª¤ã€‚</p>
        <button type="button" id="closeZeroSumModalBtn" class="btn btn-primary" data-en="OK" data-zh-HK="ç¢ºå®š">OK</button>
      </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast" aria-live="polite" hidden></div>

    <!-- Custom Numpad -->
    <div id="numpadOverlay" class="numpad-overlay" aria-hidden="true" hidden>
      <div class="numpad-backdrop" id="numpadBackdrop"></div>
      <div class="numpad-panel" id="numpadPanel">
        <div class="numpad-quick">
          <button type="button" class="numpad-quick-btn" data-quick="+10">+10</button>
          <button type="button" class="numpad-quick-btn" data-quick="+50">+50</button>
          <button type="button" class="numpad-quick-btn" data-quick="+100">+100</button>
          <button type="button" class="numpad-quick-btn" data-quick="+/-" data-en="+/-" data-zh-HK="æ­£è² ">+/-</button>
        </div>
        <div class="numpad-grid">
          <button type="button" class="numpad-key" data-key="7">7</button>
          <button type="button" class="numpad-key" data-key="8">8</button>
          <button type="button" class="numpad-key" data-key="9">9</button>
          <button type="button" class="numpad-key" data-key="4">4</button>
          <button type="button" class="numpad-key" data-key="5">5</button>
          <button type="button" class="numpad-key" data-key="6">6</button>
          <button type="button" class="numpad-key" data-key="1">1</button>
          <button type="button" class="numpad-key" data-key="2">2</button>
          <button type="button" class="numpad-key" data-key="3">3</button>
          <button type="button" class="numpad-key" data-key="0">0</button>
          <button type="button" class="numpad-key numpad-backspace" data-key="backspace" aria-label="Backspace">âŒ«</button>
          <button type="button" class="numpad-key numpad-enter" data-key="enter" data-en="Done" data-zh-HK="å®Œæˆ">Done</button>
        </div>
      </div>
    </div>

    <script type="module" src="script.js"></script>
    <script type="module">
      import { initThemeToggle } from "../../assets/theme-toggle.js";
      import { initLocaleMenu } from "../../assets/locale-menu.js";
      import { initHeader } from "../../assets/header.js";

      initHeader("../../index.html");
      initThemeToggle();
      initLocaleMenu({
        onLocaleChange: () => {
          document.dispatchEvent(new Event("localechange"));
        },
      });
    </script>
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("sw.js")
            .then(() => {})
            .catch((err) => console.warn("PWA: Service Worker registration failed", err));
        });
      }
    </script>
  </body>
</html>
